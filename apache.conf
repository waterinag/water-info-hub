<VirtualHost *:80>
    ServerName waterinag.org
    Redirect permanent / https://waterinag.org/
</VirtualHost>

<VirtualHost *:443>
    ServerName waterinag.org

    # Development mode: Proxy to Next.js dev server on port 3002
    ProxyPreserveHost On
    ProxyRequests Off
    ProxyPass / http://localhost:3008/
    ProxyPassReverse / http://localhost:3008/

    # WebSocket support for hot reloading
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*)           ws://localhost:3008/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} !=websocket [NC]
    RewriteRule /(.*)           http://localhost:3008/$1 [P,L]


    # Logs
    ErrorLog ${APACHE_LOG_DIR}/water_info_hub_error.log
    CustomLog ${APACHE_LOG_DIR}/water_info_hub_access.log combined
</VirtualHost>
